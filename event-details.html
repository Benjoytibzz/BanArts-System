<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Details - BanArts</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        .event-tabs {
            position: sticky;
            top: 0;
            z-index: 10;
            padding: 1rem 0;
            display: flex;
            gap: 2rem;
            justify-content: flex-start;
            border-bottom: 2px solid #2063f3;
        }
        .event-tab-btn {
            border: none;
            background: none;
            color: inherit;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.2em;
            outline: none !important;
            padding: 0.5rem 0;
            transition: all 0.3s ease;
        }
        .event-tab-btn.active {
            color: #007bff !important;
            text-decoration: underline !important;
            text-underline-offset: 8px;
        }
        @media (max-width: 768px) {
            .event-tabs {
                gap: 1rem;
                justify-content: flex-start;
                padding: 1rem 0;
            }
            .event-tab-btn {
                font-size: 1em;
            }
        }

        /* Image Viewer Modal Styles */
        #image-modal {
            display: none;
            justify-content: center;
            align-items: flex-start;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(4px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }
        #image-modal.show {
            display: flex;
            opacity: 1;
            pointer-events: auto;
        }
        #image-modal .modal-content {
            background-color: transparent;
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%) scale(0.9);
            padding: 0;
            border-radius: 8px;
            width: 100%;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: none;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            word-wrap: break-word;
            overflow-wrap: break-word;
            z-index: 10001;
        }
        #image-modal.show .modal-content {
            transform: translateX(-50%) scale(1);
        }
        #close-image-modal {
            z-index: 10001;
            cursor: pointer;
            transition: 0.3s;
        }
        #close-image-modal:hover {
            color: #bbb;
        }
        .artwork-card img {
            cursor: pointer;
            transition: transform 0.2s;
        }
        .artwork-card img:hover {
            transform: scale(1.02);
        }
    </style>
</head>
<body>
    <header>
        <nav role="navigation" aria-label="Main navigation">
            <div class="logo">
                <img src="img/bantayanon artists logo.jpg" alt="BanArts Logo" class="logo-img">
                BanArts
            </div>
            <div class="nav-menu">
                <div class="search-bar">
                    <label for="search-input" class="sr-only">Search artworks, artists, galleries...</label>
                    <input type="text" id="search-input" placeholder="Search artworks, artists..." aria-describedby="search-help">
                    <button type="submit" aria-label="Submit search">Search</button>
                    <div id="search-help" class="sr-only">Type to search for artworks, artists, or galleries</div>
                </div>
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/artists.html">Artists</a></li>
                    <li><a href="/artworks.html">Artworks</a></li>
                    <li><a href="/galleries.html">Galleries</a></li>
                    <li><a href="/museums.html">Museums</a></li>
                    <li><a href="/events.html">Events</a></li>
                    <li><a href="/videos.html">Videos</a></li>
                    <li><a href="/collections.html">Collections</a></li>
                </ul>
                <div class="auth-buttons">
                    <button type="button" class="login-link">Login</button>
                    <button type="button" class="signup-btn">Signup</button>
                </div>
            </div>
            <div class="mobile-header-icons">
                <div class="notification-container"></div>
                <div class="profile-dropdown-container mobile-icon">
                    <a href="/profile.html" class="profile-icon" id="profile-icon-link">
                        <div class="nav-profile-avatar" id="nav-profile-avatar"></div>
                    </a>
                    <div class="profile-dropdown">
                        <div class="profile-dropdown-header">
                            <img src="/img/profile icon.webp" alt="Profile" class="dropdown-profile-icon" id="dropdown-profile-icon">
                            <div class="dropdown-profile-name">John Doe</div>
                            <a href="/profile.html" class="view-profile-btn">View Profile</a>
                        </div>
                        <div class="profile-dropdown-item">My Collection</div>
                        <a href="/profile.html#uploads" class="profile-dropdown-item">Artworks</a>
                        <div class="dropdown-divider"></div>
                        <div class="profile-dropdown-item">Favorites</div>
                        <a href="/profile.html#saved" class="profile-dropdown-item">Saves</a>
                        <a href="/profile.html#followed" class="profile-dropdown-item">Follows</a>
                        <div class="dropdown-divider"></div>
                        <div class="profile-dropdown-item settings-header">Settings</div>
                        <a href="/settings.html" class="profile-dropdown-item edit-profile-btn">Edit Profile</a>
                        <a href="#" class="profile-dropdown-item logout-item">Logout</a>
                    </div>
                </div>
                <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                    &#9776;
                </button>
            </div>
        </nav>
    </header>

    <main style="margin-top: 100px;">
        <section class="event-details" style="padding: 2rem;">
            <img id="event-image" src="img/bantayanon artists logo.jpg" alt="Event Logo" style="width: 100px; height: auto; float: left; margin-right: 1rem; margin-bottom: 1rem;">
            <h2 id="event-name">Event Name</h2>
            <p><strong>Date:</strong> <span id="event-date"></span></p>
            <p><strong>Location:</strong> <span id="event-location"></span></p><br>
            <div class="event-tabs">
                <button class="event-tab-btn active" onclick="switchEventTab(event, 'overview')">Overview</button>
                <button class="event-tab-btn" onclick="switchEventTab(event, 'artworks')">Artworks</button>
                <button class="event-tab-btn" onclick="switchEventTab(event, 'exhibitors')">Exhibitors</button>
            </div>
            <br>
            <br>
            <div id="overview-content">
                <h3>Overview</h3>
                <p id="event-overview"></p>
            </div>
            <div id="artworks-content" style="display: none;">
                <h3>Featured Artworks</h3>
                <div id="artworks-grid" class="artworks-grid" style="margin-bottom: 1rem;">
                    <!-- Artworks will be loaded here -->
                </div>
            </div>
            <div id="exhibitors-content" style="display: none;">
                <h3>Exhibitors</h3>
                <div id="exhibitors-grid" class="artists-grid" style="margin-bottom: 1rem;">
                    <!-- Exhibitors will be loaded here -->
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>About BanArts</h3>
                <p>BanArts is the official platform of the Bantayanon Artists Group, dedicated to showcasing the rich artistic heritage and contemporary creativity of Bantayan Island, Philippines. We connect local artists with art enthusiasts worldwide.</p>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p><strong>Email:</strong> info@banarts.com<br><strong>Phone:</strong> +63 123 456 7890<br><strong>Address:</strong> Bantayan Island, Cebu, Philippines</p>
            </div>
            <div class="footer-section">
                <h3>Follow Us</h3>
                <div class="social-icons">
                    <a href="#" class="social-icon-link" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-icon-link" aria-label="Gmail"><i class="fas fa-envelope"></i></a>
                    <a href="#" class="social-icon-link" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2023 BanArts. All rights reserved.</p>
        </div>
    </footer>

    <!-- Login/Signup Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-tabs">
                <button class="tab-btn active" onclick="openTab('login')">Login</button>
                <button class="tab-btn" onclick="openTab('signup')">Signup</button>
            </div>
            <div id="login-tab" class="tab-content active">
                <img src="img/bantayanon artists logo.jpg" alt="BanArts Logo" class="modal-logo">
                <h2>Login</h2>
                <form>
                    <input type="email" placeholder="Email" required>
                    <input type="password" placeholder="Password" required>
                    <button type="submit">Login</button>
                </form>
                <div class="divider">or</div>
                <div class="social-login">
                    <a href="/auth/google" class="social-link google"><img src="img/google-icon-logo-png-transparent.png" alt="Google"></a>
                </div>
                <p class="legal-text">By clicking Sign Up or Continue with Email or Google, you agree to BanArts <a href="terms.html" style="color: blue; text-decoration: underline;">Terms and Conditions</a> and Privacy Policy. This site is protected by reCAPTCHA and the Google Privacy Policy and Terms of Service apply.</p>
            </div>
            <div id="signup-tab" class="tab-content">
                <img src="img/bantayanon artists logo.jpg" alt="BanArts Logo" class="modal-logo">
                <h2>Signup</h2>
                <form>
                    <input type="text" placeholder="Full Name" required>
                    <input type="email" placeholder="Email" required>
                    <input type="password" placeholder="Password" required>
                    <input type="password" placeholder="Confirm Password" required>
                    <button type="submit">Signup</button>
                </form>
                <div class="divider">or</div>
                <div class="social-login">
                    <a href="/auth/google" class="social-link google"><img src="img/google-icon-logo-png-transparent.png" alt="Google"></a>
                </div>
                <p class="legal-text">By clicking Sign Up or Continue with Email or Google, you agree to BanArts Terms and Conditions and Privacy Policy. This site is protected by reCAPTCHA and the Google Privacy Policy and Terms of Service apply.</p>
            </div>
        </div>
    </div>

    <!-- Image Viewing Modal -->
    <div id="image-modal" class="modal">
        <div class="modal-content" style="max-width: 90%; max-height: 90vh; background: transparent; padding: 0; box-shadow: none;">
            <span class="close" id="close-image-modal" style="color: white; font-size: 40px; position: absolute; top: 10px; right: 25px;">&times;</span>
            <img id="modal-image-large" src="" style="width: 100%; height: auto; border-radius: 8px;">
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const eventId = urlParams.get('id');
            if (eventId) {
                loadEventDetails(eventId);
            }
        });

        function loadEventDetails(id) {
            fetch(`/events/${id}`)
                .then(response => response.json())
                .then(event => {
                    document.getElementById('event-name').textContent = event.name;
                    document.getElementById('event-date').textContent = event.date ? new Date(event.date).toLocaleDateString() : '';
                    document.getElementById('event-location').textContent = event.location || '';
                    document.getElementById('event-overview').textContent = event.about || '';
                    document.getElementById('event-image').src = event.image_url || 'img/bantayanon artists logo.jpg';

                    // Parse JSON strings if needed
                    if (typeof event.artworks === 'string') {
                        try {
                            event.artworks = JSON.parse(event.artworks);
                        } catch (e) {
                            event.artworks = [];
                        }
                    }
                    if (typeof event.exhibitors === 'string') {
                        try {
                            event.exhibitors = JSON.parse(event.exhibitors);
                        } catch (e) {
                            event.exhibitors = [];
                        }
                    }

                    // Load artworks
                    if (event.artworks && Array.isArray(event.artworks) && event.artworks.length > 0) {
                        if (typeof event.artworks[0] === 'number' || typeof event.artworks[0] === 'string') {
                            // Assume ids, fetch full artworks
                            Promise.all(event.artworks.map(id => fetch(`/artworks/${id}`).then(r => r.json())))
                                .then(artworks => {
                                    const artworksGrid = document.getElementById('artworks-grid');
                                    artworksGrid.innerHTML = artworks.map(artwork => `
                                        <div class="artwork-card">
                                            <img src="${artwork.image_url || 'img/art1.jpg'}" alt="${artwork.title}" onclick="openImageModal('${artwork.image_url || 'img/art1.jpg'}')">
                                            <h3>${artwork.title}</h3>
                                            <p>${artwork.artist_name && artwork.artist_name !== 'Unknown Artist' ? 'By ' + artwork.artist_name : ''}</p>
                                        </div>
                                    `).join('');
                                })
                                .catch(error => console.error('Error loading artworks:', error));
                        } else {
                            // Assume full objects
                            const artworksGrid = document.getElementById('artworks-grid');
                            artworksGrid.innerHTML = event.artworks.map(artwork => `
                                <div class="artwork-card">
                                    <img src="${artwork.image_url || 'img/art1.jpg'}" alt="${artwork.title}" onclick="openImageModal('${artwork.image_url || 'img/art1.jpg'}')">
                                    <h3>${artwork.title}</h3>
                                    <p>${artwork.artist_name && artwork.artist_name !== 'Unknown Artist' ? 'By ' + artwork.artist_name : ''}</p>
                                </div>
                            `).join('');
                        }
                    } else {
                        document.getElementById('artworks-grid').innerHTML = '<p>No artworks selected for this event.</p>';
                    }

                    // Load exhibitors
                    if (event.exhibitors && Array.isArray(event.exhibitors) && event.exhibitors.length > 0) {
                        if (typeof event.exhibitors[0] === 'number' || typeof event.exhibitors[0] === 'string') {
                            // Assume ids, fetch full artists
                            Promise.all(event.exhibitors.map(id => fetch(`/artists/${id}`).then(r => r.json())))
                                .then(artists => {
                                    const exhibitorsGrid = document.getElementById('exhibitors-grid');
                                    exhibitorsGrid.innerHTML = artists.map(artist => `
                                        <div class="artist-card">
                                            <img src="${artist.photo_url || 'img/profile icon.webp'}" alt="${artist.name}">
                                            <h3>${artist.name}</h3>
                                            <p>${artist.category || 'Artist'}</p>
                                            <a href="artist-details.html?id=${artist.artist_id}" class="artist-link" onclick="handleViewProfile(event, ${artist.artist_id})">View Profile</a>
                                        </div>
                                    `).join('');
                                })
                                .catch(error => console.error('Error loading exhibitors:', error));
                        } else {
                            // Assume full objects
                            const exhibitorsGrid = document.getElementById('exhibitors-grid');
                            exhibitorsGrid.innerHTML = event.exhibitors.map(artist => `
                                <div class="artist-card">
                                    <img src="${artist.photo_url || 'img/profile icon.webp'}" alt="${artist.name}">
                                    <h3>${artist.name}</h3>
                                    <p>${artist.category || 'Artist'}</p>
                                    <a href="artist-details.html?id=${artist.artist_id}" class="artist-link" onclick="handleViewProfile(event, ${artist.artist_id})">View Profile</a>
                                </div>
                            `).join('');
                        }
                    } else {
                        document.getElementById('exhibitors-grid').innerHTML = '<p>No exhibitors selected for this event.</p>';
                    }
                })
                .catch(error => console.error('Error loading event details:', error));
        }

        function handleViewProfile(event, artistId) {
            if (!localStorage.getItem('userEmail')) {
                event.preventDefault();
                openModal();
                openTab('login');
            }
        }

        function switchEventTab(event, section) {
            document.getElementById('overview-content').style.display = section === 'overview' ? 'block' : 'none';
            document.getElementById('artworks-content').style.display = section === 'artworks' ? 'block' : 'none';
            document.getElementById('exhibitors-content').style.display = section === 'exhibitors' ? 'block' : 'none';

            document.querySelectorAll('.event-tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.color = 'inherit';
                btn.style.textDecoration = 'none';
            });
            
            if (event && event.currentTarget) {
                const target = event.currentTarget;
                target.classList.add('active');
                target.style.color = '#007bff';
                target.style.textDecoration = 'underline';
            }
        }

        function openImageModal(imgUrl) {
            const modal = document.getElementById('image-modal');
            const modalImg = document.getElementById('modal-image-large');
            if (modal && modalImg) {
                modalImg.src = imgUrl;
                
                // Show modal
                modal.style.display = 'flex';
                modal.style.zIndex = '10000';
                
                // Position modal at current scroll position
                const modalContent = modal.querySelector('.modal-content');
                if (modalContent) {
                    modalContent.style.top = (window.scrollY + 20) + 'px';
                }

                setTimeout(() => {
                    modal.classList.add('show');
                    document.body.classList.add('no-scroll');
                }, 10);
            }
        }

        // Close image modal logic
        document.addEventListener('DOMContentLoaded', function() {
            const imageModal = document.getElementById('image-modal');
            const closeBtn = document.getElementById('close-image-modal');

            function closeImageModal() {
                if (imageModal) {
                    imageModal.classList.remove('show');
                    document.body.classList.remove('no-scroll');
                    setTimeout(() => {
                        imageModal.style.display = 'none';
                    }, 300);
                }
            }

            if (closeBtn) {
                closeBtn.onclick = closeImageModal;
            }

            if (imageModal) {
                imageModal.onclick = function(event) {
                    if (!event.target.closest('.modal-content')) {
                        closeImageModal();
                    }
                };
            }
        });
    </script>
</body>
</html>


