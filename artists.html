<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BanArts - Modern Art Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <header>
        <nav role="navigation" aria-label="Main navigation">
            <div class="logo">
                <img src="img/bantayanon artists logo.jpg" alt="BanArts Logo" class="logo-img">
                BanArts
            </div>
            <div class="nav-menu">
                <div class="search-bar">
                    <label for="search-input" class="sr-only">Search artworks, artists, galleries...</label>
                    <input type="text" id="search-input" placeholder="Search artworks, artists..." aria-describedby="search-help">
                    <button type="submit" aria-label="Submit search">Search</button>
                    <div id="search-help" class="sr-only">Type to search for artworks, artists, or galleries</div>
                </div>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="artists.html">Artists</a></li>
                    <li><a href="artworks.html">Artworks</a></li>
                    <li><a href="galleries.html">Galleries</a></li>
                    <li><a href="museums.html">Museums</a></li>
                    <li><a href="events.html">Events</a></li>
                    <li><a href="videos.html">Videos</a></li>
                    <li><a href="collections.html">Collections</a></li>
                </ul>
                <div class="auth-buttons">
                    <button type="button" class="login-link">Login</button>
                    <button type="button" class="signup-btn">Signup</button>
                </div>
            </div>
            <div class="mobile-header-icons">
                <div class="notification-container mobile-icon"></div>
                <div class="profile-dropdown-container mobile-icon">
                    <a href="profile.html" class="profile-icon" id="profile-icon-link">
                        <div class="nav-profile-avatar" id="nav-profile-avatar"></div>
                    </a>
                    <div class="profile-dropdown">
                        <div class="profile-dropdown-header">
                            <img src="img/profile icon.webp" alt="Profile" class="dropdown-profile-icon" id="dropdown-profile-icon">
                            <div class="dropdown-profile-name">John Doe</div>
                            <a href="profile.html" class="view-profile-btn">View Profile</a>
                        </div>
                        <div class="profile-dropdown-item">My Collection</div>
                        <a href="/profile.html#uploads" class="profile-dropdown-item">Artworks</a>
                        <div class="dropdown-divider"></div>
                        <div class="profile-dropdown-item">Favorites</div>
                        <a href="/profile.html#saved" class="profile-dropdown-item">Saves</a>
                        <a href="/profile.html#followed" class="profile-dropdown-item">Follows</a>
                        <div class="dropdown-divider"></div>
                        <div class="profile-dropdown-item settings-header">Settings</div>
                        <a href="settings.html" class="profile-dropdown-item edit-profile-btn">Edit Profile</a>
                        <a href="#" class="profile-dropdown-item logout-item">Logout</a>
                    </div>
                </div>
                <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                    &#9776;
                </button>
            </div>
        </nav>
    </header>

    <main style="margin-top: 80px;">
        <section class="artists-section" style="padding: 2rem 2rem;">
            <h2>Our Artists</h2>

            <!-- Category Tabs -->
            <div class="category-tabs" style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="tab-btn active" data-category="all" style="background-color: #007bff; color: white; border: 1px solid #007bff; padding: 10px 15px; border-radius: 4px; cursor: pointer;">All</button>
                <button class="tab-btn" data-category="Painting" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px 15px; border-radius: 4px; cursor: pointer;">Painting</button>
                <button class="tab-btn" data-category="Photography" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px 15px; border-radius: 4px; cursor: pointer;">Photography</button>
                <button class="tab-btn" data-category="Mural" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px 15px; border-radius: 4px; cursor: pointer;">Mural</button>
                <button class="tab-btn" data-category="Digital" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px 15px; border-radius: 4px; cursor: pointer;">Digital</button>
                <button class="tab-btn" data-category="Drawing" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px 15px; border-radius: 4px; cursor: pointer;">Drawing</button>
                <button class="tab-btn" data-category="Sculpture" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px 15px; border-radius: 4px; cursor: pointer;">Sculpture</button>
            </div>

            <div class="artists-grid" id="artistsGrid">
                <!-- Artists will be loaded dynamically -->
            </div>
        </section>
    </main>

   <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>About BanArts</h3>
                <p>BanArts is the official platform of the Bantayanon Artists Group, dedicated to showcasing the rich artistic heritage and contemporary creativity of Bantayan Island, Philippines. We connect local artists with art enthusiasts worldwide.</p>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p><strong>Email:</strong> bantayanonartists@gmail.com<br><strong>Phone:</strong> 09481766048<br><strong>Address:</strong> Bantayan Island, Cebu, Philippines</p>
            </div>
            <div class="footer-section">
                <h3>Follow Us</h3>
                <div class="social-icons">
                    <a href="#" class="social-icon-link" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-icon-link" aria-label="Gmail"><i class="fas fa-envelope"></i></a>
                    <a href="#" class="social-icon-link" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 BanArts. All rights reserved.</p>
        </div>
    </footer>

    <!-- Login/Signup Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-tabs">
                <button class="tab-btn active" onclick="openTab('login')">Login</button>
                <button class="tab-btn" onclick="openTab('signup')">Signup</button>
            </div>
            <div id="login-tab" class="tab-content active">
                <img src="img/bantayanon artists logo.jpg" alt="BanArts Logo" class="modal-logo">
                <h2>Login</h2>
                <form id="login-form">
                    <input type="email" id="login-email" placeholder="Email" required>
                    <div class="password-field">
                        <input type="password" id="login-password" class="password-input" placeholder="Password" required>
                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)" aria-label="Show password">
                            <i class="far fa-eye"></i>
                        </button>
                    </div>
                    <div class="forgot-password-container">
                        <a href="#" id="forgot-password-link">Forgot Password?</a>
                    </div>
                    <button type="submit">Login</button>
                    <div id="login-error" style="color: red; margin-top: 1rem; display: none;"></div>
                </form>
                <div class="divider">or</div>
                <div class="social-login">
                    <a href="/auth/google" class="social-link google"><img src="img/google-icon-logo-png-transparent.png" alt="Google"></a>
                </div>
                <p class="legal-text">By clicking Sign Up or Continue with Email or Google, you agree to BanArts Terms and Conditions and Privacy Policy. This site is protected by reCAPTCHA and the Google Privacy Policy and Terms of Service apply.</p>
            </div>
            <div id="signup-tab" class="tab-content">
                <img src="img/bantayanon artists logo.jpg" alt="BanArts Logo" class="modal-logo">
                <h2>Signup</h2>
                <form id="signup-form">
                    <input type="text" id="signup-name" placeholder="Full Name" required>
                    <label for="signup-email" style="display: block; margin-bottom: 5px; font-size: 0.85rem; color: #666;">Email (Use <strong>@banarts.com</strong>)</label>
                    <input type="email" id="signup-email" placeholder="Email" required>
                    <div class="password-requirements">
                        Password must contain:
                        <ul>
                            <li>8-32 characters</li>
                            <li>At least one uppercase letter</li>
                            <li>At least one lowercase letter</li>
                            <li>At least one number</li>
                            <li>At least one special character</li>
                        </ul>
                    </div>
                    <div class="password-field">
                        <input type="password" id="signup-password" class="password-input" placeholder="Password" required>
                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)" aria-label="Show password">
                            <i class="far fa-eye"></i>
                        </button>
                    </div>
                    <div class="password-field">
                        <input type="password" id="signup-confirm-password" class="password-input" placeholder="Confirm Password" required>
                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)" aria-label="Show password">
                            <i class="far fa-eye"></i>
                        </button>
                    </div>
                    <div class="security-question-field" style="margin-top: 10px;">
                        <label for="signup-security-question" style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666;">Security Question (for account recovery)</label>
                        <select id="signup-security-question" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px; background: white;">
                            <option value="" disabled selected>Select a security question</option>
                            <option value="What was the name of your first pet?">What was the name of your first pet?</option>
                            <option value="What is your mother's maiden name?">What is your mother's maiden name?</option>
                            <option value="What was the name of your elementary school?">What was the name of your elementary school?</option>
                            <option value="In what city were you born?">In what city were you born?</option>
                            <option value="What is your favorite book?">What is your favorite book?</option>
                        </select>
                        <input type="text" id="signup-security-answer" placeholder="Your Answer" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <button type="submit">Signup</button>
                    <div id="signup-error" style="color: red; margin-top: 1rem; display: none;"></div>
                </form>
                <div class="divider">or</div>
                <div class="social-login">
                    <a href="/auth/google" class="social-link google"><img src="img/google-icon-logo-png-transparent.png" alt="Google"></a>
                </div>
                <p class="legal-text">By clicking Sign Up or Continue with Email or Google, you agree to BanArts <a href="terms.html" style="color: blue; text-decoration: underline;">Terms and Conditions</a> and Privacy Policy. This site is protected by reCAPTCHA and the Google Privacy Policy and Terms of Service apply.</p>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgot-password-modal" class="modal" role="dialog" aria-labelledby="forgot-password-title" aria-modal="true" aria-hidden="true">
        <div class="modal-content">
            <span class="close-forgot-password close" aria-label="Close modal">&times;</span>
            <div id="forgot-password-tab" class="tab-content active">
                <img src="img/bantayanon artists logo.jpg" alt="BanArts Logo" class="modal-logo">
                <h2 id="forgot-password-title">Change Password</h2>
                <p class="modal-subtitle">Securely update your account credentials</p>
                <form id="forgot-password-form">
                    <!-- Step 1: Email -->
                    <div id="forgot-step-1">
                        <div class="input-group">
                            <i class="fas fa-envelope input-icon"></i>
                            <input type="email" id="reset-email" placeholder="Email Address" required>
                        </div>
                        <button type="button" id="forgot-next-btn" class="submit-btn" style="margin-top: 15px;">Next</button>
                    </div>

                    <!-- Step 2: Security Question & New Password -->
                    <div id="forgot-step-2" style="display: none;">
                        <div class="security-question-box" style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin-bottom: 15px; border-left: 4px solid #007bff;">
                            <p style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">Security Question:</p>
                            <p id="display-security-question" style="font-weight: 500; color: #333;"></p>
                        </div>
                        <div class="input-group">
                            <i class="fas fa-key input-icon"></i>
                            <input type="text" id="reset-security-answer" placeholder="Your Answer" required>
                        </div>
                        <div class="password-requirements">
                            New password must contain:
                            <ul>
                                <li>8-32 characters</li>
                                <li>At least one uppercase letter</li>
                                <li>At least one lowercase letter</li>
                                <li>At least one number</li>
                                <li>At least one special character</li>
                            </ul>
                        </div>
                        <div class="password-field">
                            <div class="input-group">
                                <i class="fas fa-lock input-icon"></i>
                                <input type="password" id="reset-new-password" class="password-input" placeholder="New Password" required>
                            </div>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)" aria-label="Show password">
                                <i class="far fa-eye"></i>
                            </button>
                        </div>
                        <div class="password-field">
                            <div class="input-group">
                                <i class="fas fa-shield-alt input-icon"></i>
                                <input type="password" id="reset-confirm-password" class="password-input" placeholder="Confirm New Password" required>
                            </div>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)" aria-label="Show password">
                                <i class="far fa-eye"></i>
                            </button>
                        </div>
                        <button type="submit" class="submit-btn">Update Password</button>
                    </div>
                    <div id="forgot-password-error" class="error-message" style="display: none; color: red; margin-top: 10px;"></div>
                    <div id="forgot-password-success" class="success-message" style="display: none; color: green; margin-top: 10px;"></div>
                </form>
                <div class="back-to-login">
                    <a href="#" id="back-to-login-link"><i class="fas fa-arrow-left"></i> Back to Login</a>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        let allArtists = [];

        async function loadArtists() {
            try {
                // Load all artists
                const response = await fetch('/artists');
                if (response.ok) {
                    allArtists = await response.json();
                    renderArtists('all');
                }
            } catch (error) {
                console.error('Error loading artists:', error);
            }
        }

        function renderArtists(category) {
            const artistsSection = document.querySelector('.artists-section .artists-grid');
            // Clear existing content
            artistsSection.innerHTML = '';

            let filteredArtists = allArtists;
            if (category !== 'all') {
                filteredArtists = allArtists.filter(artist => {
                    const artistCategories = artist.category ? artist.category.split(', ') : [];
                    return artistCategories.includes(category);
                });
            }

            if (filteredArtists.length === 0) {
                artistsSection.innerHTML = '<p>No artists in this category yet.</p>';
                return;
            }

            filteredArtists.forEach(artist => {
                const card = document.createElement('div');
                card.className = 'artist-card';
                card.innerHTML = `
                    <img src="${artist.photo_url || 'img/profile icon.webp'}" alt="${artist.name}">
                    <h3>${artist.name}</h3>
                    <p>${artist.about ? (artist.about.length > 100 ? artist.about.substring(0, 100) + '...' : artist.about) : 'Artist from Bantayan Island'}</p>
                    <button class="artist-link" onclick="openAuthModalForArtistDetail(${artist.artist_id})">View Profile</button>
                    <button class="follow-btn" data-artist-id="${artist.artist_id}">Follow</button>
                `;
                artistsSection.appendChild(card);
            });

            // Add event listeners to dynamically created follow buttons
            document.querySelectorAll('.artists-section .follow-btn').forEach(btn => {
                const artistId = btn.getAttribute('data-artist-id');
                const userId = localStorage.getItem('userId');
                
                // Check if user is following this artist
                if (userId && artistId) {
                    fetch(`/followed-artists/${userId}`)
                        .then(response => response.json())
                        .then(followedArtists => {
                            const isFollowed = followedArtists.some(artist => artist.artist_id == artistId);
                            updateFollowButton(btn, isFollowed);
                        })
                        .catch(err => {
                            console.error('Error checking follow status:', err);
                        });
                }
                
                btn.addEventListener('click', function() {
                    const userEmail = localStorage.getItem('userEmail');
                    if (!userEmail) {
                        openModal();
                        openTab('signup');
                        return;
                    }

                    const artistId = this.getAttribute('data-artist-id');
                    if (!artistId) {
                        alert('Artist ID not found. Please try again.');
                        return;
                    }

                    // Call follow/unfollow API
                    fetch('/follow-artist', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'user-id': localStorage.getItem('userId')
                        },
                        body: JSON.stringify({ artist_id: artistId })
                    })
                    .then(response => response.json())
                    .then(data => {
                        updateFollowButton(this, data.followed);
                        console.log(data.message);
                    })
                    .catch(err => {
                        console.error('Follow error:', err);
                        alert('Error updating follow status. Please try again.');
                    });
                });
            });
        }

        // Open auth modal for artist detail access or redirect if logged in
        function openAuthModalForArtistDetail(artistId) {
            const userId = localStorage.getItem('userId');
            if (userId) {
                window.location.href = `artist-details.html?id=${artistId}`;
            } else {
                openModal();
                openTab('signup');
            }
        }

        // Load artists when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadArtists();

            // Add event listeners for category tabs
            document.querySelectorAll('.category-tabs .tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons and reset styles
                    document.querySelectorAll('.category-tabs .tab-btn').forEach(b => {
                        b.classList.remove('active');
                        b.style.backgroundColor = '#f8f9fa';
                        b.style.color = '#333';
                    });
                    // Add active to clicked button and set styles
                    this.classList.add('active');
                    this.style.backgroundColor = '#007bff';
                    this.style.color = 'white';
                    // Render artists for the selected category
                    const category = this.getAttribute('data-category');
                    renderArtists(category);
                });
            });
        });

        // Helper functions
        function updateFollowButton(btn, isFollowed) {
            if (isFollowed) {
                btn.textContent = 'Followed';
                btn.classList.add('followed');
            } else {
                btn.textContent = 'Follow';
                btn.classList.remove('followed');
            }
        }

        // Modal functionality
        function openModal() {
            const modal = document.getElementById('auth-modal');
            modal.style.display = 'flex';
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.style.pointerEvents = 'auto';
            }, 10);
            modal.setAttribute('aria-hidden', 'false');
            document.body.classList.add('no-scroll'); // Prevent background scrolling

            // Focus management
            const firstFocusableElement = modal.querySelector('.close') || modal.querySelector('.tab-btn');
            if (firstFocusableElement) {
                firstFocusableElement.focus();
            }
        }

        function closeModal() {
            const modal = document.getElementById('auth-modal');
            modal.style.opacity = '0';
            modal.style.pointerEvents = 'none';
            modal.setAttribute('aria-hidden', 'true');
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.classList.remove('no-scroll'); // Restore scrolling
            }, 300); // Match animation duration
        }

        function openTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => {
                tab.classList.remove('active');
                tab.setAttribute('aria-hidden', 'true');
            });
            buttons.forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-selected', 'false');
            });
            document.getElementById(tabName + '-tab').classList.add('active');
            document.getElementById(tabName + '-tab').setAttribute('aria-hidden', 'false');

            // Find the corresponding tab button and add active
            const activeBtn = document.querySelector(`.tab-btn[onclick*="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.setAttribute('aria-selected', 'true');
            }

            // Update modal title for screen readers
            const modalTitle = document.getElementById('modal-title');
            if (modalTitle) {
                modalTitle.textContent = tabName.charAt(0).toUpperCase() + tabName.slice(1);
            }
        }

        // Event listeners for modal
        document.addEventListener('DOMContentLoaded', function() {
            const loginBtn = document.querySelector('.login-link');
            const signupBtn = document.querySelector('.signup-btn');
            const closeBtn = document.querySelector('.close');

            if (loginBtn) loginBtn.addEventListener('click', function(e) {
                e.preventDefault();
                openModal();
                openTab('login');
            });

            if (signupBtn) signupBtn.addEventListener('click', function(e) {
                e.preventDefault();
                openModal();
                openTab('signup');
            });

            if (closeBtn) closeBtn.addEventListener('click', closeModal);

            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                const modal = document.getElementById('auth-modal');
                if (e.target === modal) {
                    closeModal();
                }
            });
        });
    </script>
    <script src="/socket.io/socket.io.js"></script>
    
</body>
</html>


